# 04.17 독서 인증

---
## 테스트 주도 개발 시작하기 (140 - 208)

---

- 테스트를 작성하다 보면 외부 요인이 필요한 시점이 있다.
    - 테스트 대상에서 파일 시스템을 이용할 때
    - 테스트 대상에서 DB로부터 데이터를 조회하거나 데이터를 추가할 때
    - 테스트 대상에서 외부의 HTTP 서버와 통신할 때
- 테스트 대상이 외부 요인을 의존할 경우 테스트가 어려워진다. 테스트 결과도 예측할 수 없다.
- 테스트 코드에서 외부 요인때문에 테스트하기 어려운 경우 대역을 사용해 테스트를 진행한다.
    - 대역은 테스트 더블이라고도 부른다. 
    - 주로 인터페이스를 활용하여 테스트 더블을 진행할 수 있다.
- 대역의 종류
    - Stub : 구현을 단순한 것으로 대체
    - Fake : 제품에는 적합하지 않지만 실제 동작하는 구현을 제공
    - Spy : 호출된 내역을 기록하는 일종의 스텁.
    - Mock : 기대한 대로 상호작용하는지 행위를 검증.
    - 아직 그 차이는 모호한 것 같다.
-  제어하기 힘든 외부 상황이 존재한다면 다음과 같이 대역을 이용한다.
    - 제어하기 힘든 외부 상황을 별도 타입으로 분리
    - 테스트 코드는 별도로 분리한 타입의 대역을 생성
    - 생성한 대역을 테스트 대상의 생성자 등을 이용해서 전달
    - 대역을 이용해서 상황 구성
- 이전에 레벨 1 미션을 하면서 자주 사용했던 인터페이스로 분리하여 테스트를 하도록 했던 것과 같은 말인 것 같다.
- 대역은 의존하는 대상을 구현하지 않아도 테스트 대상을 완성할 수 있게 만들어주며 이는 대기 시간을 줄여주어 개발 속도를 올리는 데 도움이 된다.

### 테스트 가능한 설계
- 테스트하기 어려운 코드
    - 하드 코딩된 경로
    - 의존 객체를 직접 생성해서 사용하는 경우
    - 정적 메서드를 사용하는 경우
    - 실행 시점에 따라 달라지는 결과
    - 역할이 섞여있는 코드
- 테스트 가능한 설계
    - 하드 코딩된 상수를 생성자 or 메서드 파라미터로 받기
    - 의존 대상을 주입 받기 ( 대역 생성을 위함 )
    - 테스트하고 싶은 코드를 분리하기 ( 책임 분리를 통한 테스트 유도 )
    - 시간이나 임의 값 생성 기능은 분리하기 ( 임의 값을 대역으로 처리할 수 있도록 )
    - 외부 라이브러리는 직접 사용하지 않고 감싸서 사용하기
        - 의존 대상을 주입받는 것과 동일한 원리

### 테스트 범위와 종류
- 기능 테스트 (E2E 테스트)
    - 사용자 입장에서 시스템이 제공하는 기능이 올바르게 동작하는지 확인
    - 웹 브라우저나 모바일 앱부터 시작해서 데이터베이스나 외부 서비스에 이르기까지 모든 구성 요소를 하나로 엮어서 진행한다.
- 통합 테스트
    - 시스템의 각 구성 요소가 올바르게 연동되는지 확인
    - 주로 프레임워크, 라이브러리, 데이터베이스, 구현한 코드가 주요 통합 테스트 대상이 된다.
- 단위 테스트
    - 개별 코드나 컴포넌트가 기대한대로 동작하는지 확인
    - 일부 의존 대상은 스텁이나 모의 객체 등을 통해 대역으로 대체함
- 테스트 속도는 통합 테스트보다 단위 테스트가 빠르기 때문에 가능하면 단위 테스트에서 다양한 상황을 다루고, 통합 테스트나 기능 테스트는 주요 상황에 초점을 맞추어야 한다.
    - 너무 예외적인 상황까지 통합 테스트에서 진행하려 하지 말라
- 새로 알게된 거 : `WireMock`, `TestRestTemplate`
